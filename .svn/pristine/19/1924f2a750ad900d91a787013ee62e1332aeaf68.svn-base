import HomeView from "./HomeView";
import RoleChangeScene from "../role/RoleChangeScene";
import GameScene from "../game/GameScene";
import MatchGradeScene from "../MatchGrade/MatchGradeScene";
import RankingListScene from "../Rank/RankingListScene";

export default class HomeScene extends Scene{
    constructor() {
        super();
        let homeView = new HomeView();
        this.view = homeView
    }
    viewWillAppear() {
        console.log(PaoYa.DataCenter.login)
        let userData = PaoYa.DataCenter.user
        console.log(userData)
        var a = 70;
        console.log('4444444', new Number(90).formatTime())
        this.showWxIcon()
    }
    onViewClick(e) {
        switch (e.target.name) {
            case 'btnRules':
                Laya.Scene.open('scene/dialog/RuleDialog.json')
                break
            case 'friendhoho':
                this.tofriend()
                break
            case 'morepeople':
                let rolechange = new RoleChangeScene()
                this.navigator.push(rolechange)
                break
            case 'btnToThen':
                let homethen = new MatchGradeScene()
                this.navigator.push(homethen)
                break
            case 'btnSet':
                var setdialog = new SettingDialog();
                setdialog.popup();
                break
            case 'btnRank':
                var rankingList = new RankingListScene()
                this.navigator.push(rankingList)
                break
            case 'skeletonBox':
            PaoYa.DataTrack.trackType(PaoYa.DataTrackType.Jump);
            this.moreGame();
                break
        }
    }
    tofriend() {
        PaoYa.Game.ins.ifService.createRoom();
    }
    static goGame(data1, data2) {
        PaoYa.DataCenter.ownData = data1
        console.log('比赛数据：', data1, data2);

        var params = { self: null, other: null, gameConfig: null };
        params.gameConfig = data2.game_config;
        if (data1.match_list[0].user_id == PaoYa.DataCenter.user.id) {
            params.self = data1.match_list[0];
            params.other = data1.match_list[1];
        } else {
            params.self = data1.match_list[1];
            params.other = data1.match_list[0];
        }
        var gameScene = new GameScene(params)
        PaoYa.Game.ins.navigator.push(gameScene);
    }
    showWxIcon () {
        if (!PaoYa.DataCenter.config) { return; }
        var config = PaoYa.DataCenter.config;
        if (!config.common_config.share_info) { return; }
        this.jumpInfo = config.common_config.share_info.randomItem;
        var randomIconUrl = this.jumpInfo.spine_url;
        if (this.moreGameSkeleton) {
            this.moreGameSkeleton.load(randomIconUrl, Laya.Handler.create(this, function () {
                this.moreGameSkeleton.play();
            }))
        } else {
            this.moreGameSkeleton = new Laya.Skeleton();
            this.moreGameSkeleton.load(randomIconUrl, Laya.Handler.create(this, function () {
                this.moreGameSkeleton.play();
            }));
            // this.view.skeletonBox.on(Laya.Event.CLICK, this, function () {
               
            // })
            this.moreGameSkeleton.width = 130;
            this.moreGameSkeleton.height = 130;
            this.moreGameSkeleton.pos(65, 65)
            Laya.timer.once(100,this,()=>{this.view.skeletonBox.addChild(this.moreGameSkeleton);})
        }
    }

    moreGame () {
        var _this = this;
        Service.navigateToMiniProgram({
            appId: _this.jumpInfo.appId,
            images: [_this.jumpInfo.img]
        });
    }
}
